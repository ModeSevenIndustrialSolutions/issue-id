---
# SPDX-License-Identifier: Apache-2.0
# SPDX-FileCopyrightText: 2024 The Linux Foundation

name: "🛠️ Get default GIT branch"

outputs:
  DEFAULT_BRANCH:
    description: "Default branch name of repository"
  EVENT_REF_MATCHES:
    description: "True when github.event.repository.default_branch = github.event.ref_name"

runs:
  using: "composite"
  steps:
    - name: "Get repository default GIT branch"
      shell: bash
      run: |
        # Get repository default GIT branch
        DEFAULT_BRANCH="${{ github.event.repository.default_branch }}"
        EVENT_REF_NAME="${{ github.event.ref_name }}"
        if [ -z "$DEFAULT_BRANCH" ] || [ -z "$EVENT_REF_NAME" ]; then
          echo "Expected values were NOT populated ❌"; exit 1
        fi
        echo "Repository default branch: $DEFAULT_BRANCH ✅" >> "$GITHUB_STEP_SUMMARY"
        echo "Repository default branch: $DEFAULT_BRANCH ✅"
        if [ "$DEFAULT_BRANCH" = "$EVENT_REF_NAME" ]; then
          EVENT_REF_MATCHES="true"
          echo "GitHub event ref name: $EVENT_REF_NAME ✅" >> "$GITHUB_STEP_SUMMARY"
          echo "GitHub event ref name: $EVENT_REF_NAME ✅"
        else
          EVENT_REF_MATCHES="false"
          echo "GitHub event ref name: $EVENT_REF_NAME" >> "$GITHUB_STEP_SUMMARY"
          echo "GitHub event ref name: $EVENT_REF_NAME"
        fi
        # Return results
        echo "default_branch=$DEFAULT_BRANCH" >> "$GITHUB_ENV"
        echo "default_branch=$DEFAULT_BRANCH" >> "$GITHUB_OUTPUT"
        echo "event_ref_matches=$EVENT_REF_MATCHES" >> "$GITHUB_ENV"
        echo "event_ref_matches=$EVENT_REF_MATCHES" >> "$GITHUB_OUTPUT"
