---
# SPDX-License-Identifier: Apache-2.0
# SPDX-FileCopyrightText: 2024 The Linux Foundation

name: "üí¨ GIT Commit Message"

inputs:
  REF:
    description: "GIT ref to checkout"
    required: false
    default: ${{ github.head_ref }}
  FETCH_DEPTH:
    description: "Fetch depth to checkout"
    required: false
    default: 0

outputs:
  COMMIT_MESSAGE:
    description: "GIT commit message"
    value: ${{ steps.return.outputs.commit_message }}

runs:
  using: "composite"
  steps:
    - name: Checkout
      uses: actions/checkout@v4
      with:
        ref: ${{ inputs.REF }}
        fetch-depth: ${{ inputs.FETCH_DEPTH }}

    - name: "Retrieve GIT commit message"
      id: return
      shell: bash
      run: |
        # Retrieve GIT commit message
        using "Pulled repository with ref: ${{ inputs.REF }} and depth ${{ inputs.FETCH_DEPTH }}"
        COMMIT_MESSAGE=$(git show -s --format='%B')
        if [ -z "$COMMIT_MESSAGE" ]; then
          echo "GIT Commit Message string was empty ‚ùå" >> "$GITHUB_STEP_SUMMARY"
          echo "GIT Commit Message string was empty ‚ùå"; exit 1
        fi
        echo "COMMIT_MESSAGE<<EOF"$'\n'"$COMMIT_MESSAGE"$'\n'EOF >> "$GITHUB_ENV"
        echo "COMMIT_MESSAGE<<EOF"$'\n'"$COMMIT_MESSAGE"$'\n'EOF >> "$GITHUB_OUTPUT"
        echo "üí¨ GIT Commit Message"
        echo "$COMMIT_MESSAGE"
